# 新增功能说明

## 1. 本地视频上传

### API

1. /api/local/upload-video - 上传后写入数据库
✅ 上传成功后立即在 video_analyses 表创建记录
✅ 如果用户已登录，同时写入 user_videos 关联表
✅ 返回 videoAnalysisId（UUID）供后续使用

2. /api/local/upload-subtitle - 更新转写文本
✅ 解析字幕后更新 video_analyses.transcript 字段
✅ 即使更新失败也不影响前端获取转写结果

3. /api/video-analysis-id - 统一查询逻辑
✅ 移除本地视频的 storage 查询分支
✅ 本地和网络视频统一从 video_analyses 表查询
✅ 返回标准的 UUID，前端可直接用于收藏/笔记

4. 前端组件 - 传递 videoAnalysisId
✅ LocalVideoUpload  组件接收并存储 videoAnalysisId
✅ app/page.tsx 的回调函数同步更新
✅ 通过 sessionStorage 传递给分析页面

### 数据流


视频文件 → Supabase Storage (videos 桶)
元数据 → video_analyses 表（transcript: [], topics: []）
用户关联 → user_videos 表（如果已登录）
字幕上传 → 更新 video_analyses.transcript
AI 分析 → 更新 video_analyses.topics
