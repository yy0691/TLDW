# æ–°åŠŸèƒ½è¯´æ˜ / New Features

## æ¦‚è¿° / Overview

æœ¬æ¬¡æ›´æ–°ä¸º TLDW é¡¹ç›®æ·»åŠ äº†ä¸‰ä¸ªä¸»è¦åŠŸèƒ½ï¼š

1. **Bilibili è§†é¢‘æ”¯æŒ** - æ”¯æŒåˆ†æ Bilibili è§†é¢‘
2. **æœ¬åœ°è§†é¢‘ä¸Šä¼ ** - æ”¯æŒä¸Šä¼ æœ¬åœ°è§†é¢‘åŠå­—å¹•æ–‡ä»¶
3. **è§†é¢‘åˆé›†ç®¡ç†** - æ‰¹é‡ç®¡ç†å’Œç»„ç»‡è§†é¢‘ç³»åˆ—

---

## 1. Bilibili è§†é¢‘æ”¯æŒ

### åŠŸèƒ½è¯´æ˜
- æ”¯æŒè§£æ Bilibili è§†é¢‘ URLï¼ˆBVå·å’ŒAVå·ï¼‰
- è‡ªåŠ¨è·å–è§†é¢‘ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€ä½œè€…ã€å°é¢ç­‰ï¼‰
- è‡ªåŠ¨æå–è§†é¢‘å­—å¹•è¿›è¡Œåˆ†æ

### æ”¯æŒçš„ URL æ ¼å¼
```
https://www.bilibili.com/video/BVxxxxxxxxx
https://www.bilibili.com/video/avxxxxxxxx
https://b23.tv/xxxxxxx
```

### ä½¿ç”¨æ–¹æ³•
1. åœ¨ä¸»é¡µè¾“å…¥æ¡†ç²˜è´´ Bilibili è§†é¢‘é“¾æ¥
2. ç‚¹å‡»æäº¤æŒ‰é’®
3. ç³»ç»Ÿè‡ªåŠ¨æå–å­—å¹•å¹¶ç”Ÿæˆåˆ†æ

### API ç«¯ç‚¹
- `POST /api/bilibili/video-info` - è·å– Bilibili è§†é¢‘ä¿¡æ¯
- `POST /api/bilibili/transcript` - è·å– Bilibili è§†é¢‘å­—å¹•

---

## 2. æœ¬åœ°è§†é¢‘ä¸Šä¼ 

### åŠŸèƒ½è¯´æ˜
- æ”¯æŒä¸Šä¼ æœ¬åœ°è§†é¢‘æ–‡ä»¶ï¼ˆMP4, WebM, OGG, MOVï¼‰
- æ”¯æŒä¸Šä¼ å­—å¹•æ–‡ä»¶ï¼ˆSRT, VTTï¼‰
- è‡ªåŠ¨è§£æå­—å¹•æ–‡ä»¶å¹¶ç”Ÿæˆæ—¶é—´è½´
- è§†é¢‘æ–‡ä»¶å­˜å‚¨åœ¨ Supabase Storage

### é™åˆ¶
- è§†é¢‘æ–‡ä»¶å¤§å°ï¼šæœ€å¤§ 500MB
- æ”¯æŒçš„è§†é¢‘æ ¼å¼ï¼šMP4, WebM, OGG, MOV
- æ”¯æŒçš„å­—å¹•æ ¼å¼ï¼šSRT, VTT
- **éœ€è¦ç™»å½•** - ä¸Šä¼ æœ¬åœ°è§†é¢‘éœ€è¦ç”¨æˆ·è®¤è¯

### ä½¿ç”¨æ–¹æ³•
1. åœ¨ä¸»é¡µåˆ‡æ¢åˆ°"Local Upload"æ ‡ç­¾
2. ç‚¹å‡»"Select Video"é€‰æ‹©è§†é¢‘æ–‡ä»¶
3. ç‚¹å‡»"Select Subtitle"é€‰æ‹©å­—å¹•æ–‡ä»¶
4. å¡«å†™è§†é¢‘æ ‡é¢˜ï¼ˆå¿…å¡«ï¼‰å’Œä½œè€…ï¼ˆå¯é€‰ï¼‰
5. ç‚¹å‡»"Upload & Analyze"ä¸Šä¼ å¹¶åˆ†æ

### API ç«¯ç‚¹
- `POST /api/local/upload-video` - ä¸Šä¼ è§†é¢‘æ–‡ä»¶
- `POST /api/local/upload-subtitle` - ä¸Šä¼ å¹¶è§£æå­—å¹•æ–‡ä»¶

### å­—å¹•æ ¼å¼ç¤ºä¾‹

#### SRT æ ¼å¼
```srt
1
00:00:00,000 --> 00:00:05,000
è¿™æ˜¯ç¬¬ä¸€å¥å­—å¹•

2
00:00:05,000 --> 00:00:10,000
è¿™æ˜¯ç¬¬äºŒå¥å­—å¹•
```

#### VTT æ ¼å¼
```vtt
WEBVTT

00:00:00.000 --> 00:00:05.000
è¿™æ˜¯ç¬¬ä¸€å¥å­—å¹•

00:00:05.000 --> 00:00:10.000
è¿™æ˜¯ç¬¬äºŒå¥å­—å¹•
```

---

## 3. è§†é¢‘åˆé›†ç®¡ç†

### åŠŸèƒ½è¯´æ˜
- åˆ›å»ºè§†é¢‘åˆé›†æ¥ç»„ç»‡ç›¸å…³è§†é¢‘
- å°†åˆ†æè¿‡çš„è§†é¢‘æ·»åŠ åˆ°åˆé›†
- æŒ‰é¡ºåºç®¡ç†åˆé›†ä¸­çš„è§†é¢‘
- ä»åˆé›†è¯¦æƒ…é¡µå¿«é€Ÿè®¿é—®è§†é¢‘

### ä½¿ç”¨æ–¹æ³•

#### åˆ›å»ºåˆé›†
1. è®¿é—® `/collections` é¡µé¢
2. ç‚¹å‡»"New Collection"æŒ‰é’®
3. è¾“å…¥åˆé›†æ ‡é¢˜å’Œæè¿°ï¼ˆå¯é€‰ï¼‰
4. ç‚¹å‡»"Create"åˆ›å»ºåˆé›†

#### æ·»åŠ è§†é¢‘åˆ°åˆé›†
1. åœ¨è§†é¢‘åˆ†æé¡µé¢ï¼Œæ‰¾åˆ°"Add to Collection"æŒ‰é’®
2. é€‰æ‹©è¦æ·»åŠ åˆ°çš„åˆé›†
3. è§†é¢‘ä¼šè‡ªåŠ¨æ·»åŠ åˆ°åˆé›†æœ«å°¾

#### ç®¡ç†åˆé›†
- æŸ¥çœ‹åˆé›†åˆ—è¡¨ï¼šè®¿é—® `/collections`
- æŸ¥çœ‹åˆé›†è¯¦æƒ…ï¼šç‚¹å‡»åˆé›†å¡ç‰‡
- åˆ é™¤è§†é¢‘ï¼šåœ¨åˆé›†è¯¦æƒ…é¡µç‚¹å‡»è§†é¢‘æ—çš„åˆ é™¤æŒ‰é’®
- åˆ é™¤åˆé›†ï¼šåœ¨åˆé›†åˆ—è¡¨é¡µç‚¹å‡»åˆé›†çš„åˆ é™¤æŒ‰é’®

### API ç«¯ç‚¹
- `GET /api/collections` - è·å–ç”¨æˆ·çš„æ‰€æœ‰åˆé›†
- `POST /api/collections` - åˆ›å»ºæ–°åˆé›†
- `DELETE /api/collections` - åˆ é™¤åˆé›†
- `GET /api/collections/[id]` - è·å–åˆé›†è¯¦æƒ…
- `PATCH /api/collections/[id]` - æ›´æ–°åˆé›†ä¿¡æ¯
- `POST /api/collections/[id]/videos` - æ·»åŠ è§†é¢‘åˆ°åˆé›†
- `DELETE /api/collections/[id]/videos` - ä»åˆé›†ç§»é™¤è§†é¢‘

---

## æ•°æ®åº“å˜æ›´

### æ–°å¢è¡¨

#### video_collections
```sql
- id: UUID (ä¸»é”®)
- user_id: UUID (å¤–é”® -> auth.users)
- title: TEXT (åˆé›†æ ‡é¢˜)
- description: TEXT (åˆé›†æè¿°)
- thumbnail: TEXT (å°é¢å›¾)
- video_count: INTEGER (è§†é¢‘æ•°é‡)
- created_at: TIMESTAMPTZ
- updated_at: TIMESTAMPTZ
```

#### collection_videos
```sql
- id: UUID (ä¸»é”®)
- collection_id: UUID (å¤–é”® -> video_collections)
- video_analysis_id: UUID (å¤–é”® -> video_analyses)
- order: INTEGER (æ’åº)
- added_at: TIMESTAMPTZ
```

### ä¿®æ”¹è¡¨

#### video_analyses
- æ–°å¢å­—æ®µï¼š`source` TEXT (è§†é¢‘æ¥æº: 'youtube', 'bilibili', 'local')

---

## æŠ€æœ¯å®ç°

### è§†é¢‘æºæ£€æµ‹
```typescript
// è‡ªåŠ¨æ£€æµ‹è§†é¢‘æ¥æº
import { detectVideoSource } from '@/lib/utils';

const source = detectVideoSource(url);
// è¿”å›: 'youtube' | 'bilibili' | null
```

### å­—å¹•è§£æ
```typescript
// è§£æ SRT/VTT å­—å¹•æ–‡ä»¶
import { parseSubtitle } from '@/lib/subtitle-parser';

const transcript = parseSubtitle(content, filename);
// è¿”å›: TranscriptSegment[]
```

### Bilibili API
```typescript
// è·å– Bilibili è§†é¢‘ä¿¡æ¯
const response = await fetch('/api/bilibili/video-info', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ url: bilibiliUrl })
});

// è·å– Bilibili å­—å¹•
const response = await fetch('/api/bilibili/transcript', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ url: bilibiliUrl })
});
```

---

## ç¯å¢ƒé…ç½®

æ— éœ€é¢å¤–çš„ç¯å¢ƒå˜é‡ã€‚ç°æœ‰çš„ Supabase é…ç½®å³å¯æ”¯æŒæ–°åŠŸèƒ½ã€‚

### Supabase Storage
ç¡®ä¿åœ¨ Supabase é¡¹ç›®ä¸­å·²åˆ›å»º `videos` bucketï¼š
1. ç™»å½• Supabase Dashboard
2. è¿›å…¥ Storage é¡µé¢
3. è¿è¡Œè¿ç§»è„šæœ¬æˆ–æ‰‹åŠ¨åˆ›å»º `videos` bucket
4. è®¾ç½®ä¸º publicï¼ˆå…è®¸ç”¨æˆ·è®¿é—®ä¸Šä¼ çš„è§†é¢‘ï¼‰

---

## è¿ç§»æŒ‡å—

### 1. æ•°æ®åº“è¿ç§»
è¿è¡Œä»¥ä¸‹è¿ç§»è„šæœ¬ï¼š
```bash
# åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œ
supabase/migrations/20240101000000_add_collections.sql
supabase/migrations/20240101000001_add_videos_storage.sql
```

### 2. æ›´æ–°ä¾èµ–
é¡¹ç›®å·²åŒ…å«æ‰€æœ‰å¿…è¦ä¾èµ–ï¼Œæ— éœ€é¢å¤–å®‰è£…ã€‚

### 3. æµ‹è¯•åŠŸèƒ½
1. æµ‹è¯• Bilibili è§†é¢‘åˆ†æ
2. æµ‹è¯•æœ¬åœ°è§†é¢‘ä¸Šä¼ ï¼ˆéœ€è¦ç™»å½•ï¼‰
3. æµ‹è¯•åˆé›†åˆ›å»ºå’Œç®¡ç†

---

## å¸¸è§é—®é¢˜

### Q: Bilibili è§†é¢‘æ²¡æœ‰å­—å¹•æ€ä¹ˆåŠï¼Ÿ
A: ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å­—å¹•ã€‚å¦‚æœè§†é¢‘æ²¡æœ‰å­—å¹•ï¼Œä¼šè¿”å› 404 é”™è¯¯å¹¶æç¤ºç”¨æˆ·ã€‚

### Q: æœ¬åœ°è§†é¢‘ä¸Šä¼ å¤±è´¥ï¼Ÿ
A: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
- æ˜¯å¦å·²ç™»å½•
- è§†é¢‘æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡ 500MB
- è§†é¢‘æ ¼å¼æ˜¯å¦æ”¯æŒ
- å­—å¹•æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®

### Q: åˆé›†åŠŸèƒ½éœ€è¦ç™»å½•å—ï¼Ÿ
A: æ˜¯çš„ï¼Œè§†é¢‘åˆé›†åŠŸèƒ½éœ€è¦ç”¨æˆ·è®¤è¯ã€‚

### Q: å¯ä»¥å°† YouTube å’Œ Bilibili è§†é¢‘æ”¾åœ¨åŒä¸€ä¸ªåˆé›†å—ï¼Ÿ
A: å¯ä»¥ï¼åˆé›†æ”¯æŒæ··åˆä¸åŒæ¥æºçš„è§†é¢‘ã€‚

---

## æœªæ¥è®¡åˆ’

- [ ] æ”¯æŒæ›´å¤šè§†é¢‘å¹³å°ï¼ˆä¼˜é…·ã€è…¾è®¯è§†é¢‘ç­‰ï¼‰
- [ ] è‡ªåŠ¨å­—å¹•ç”Ÿæˆï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰
- [ ] æ‰¹é‡ä¸Šä¼ è§†é¢‘åˆ°åˆé›†
- [ ] åˆé›†åˆ†äº«åŠŸèƒ½
- [ ] è§†é¢‘ä¸‹è½½åŠŸèƒ½

---

## è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## è®¸å¯è¯

ä¸ä¸»é¡¹ç›®ä¿æŒä¸€è‡´



# åŠŸèƒ½æ›´æ–°æ€»ç»“ / Feature Updates Summary

## âœ… å·²å®Œæˆçš„åŠŸèƒ½

### 1. å¤šè§†é¢‘æºæ”¯æŒ âœ“

**YouTube è§†é¢‘** (åŸæœ‰åŠŸèƒ½)
- âœ“ æ”¯æŒ YouTube URL è§£æ
- âœ“ è‡ªåŠ¨è·å–è§†é¢‘ä¿¡æ¯å’Œå­—å¹•

**Bilibili è§†é¢‘** (æ–°å¢)
- âœ“ æ”¯æŒ Bilibili URL è§£æ (BV/AVæ ¼å¼)
- âœ“ è‡ªåŠ¨è·å–è§†é¢‘ä¿¡æ¯
- âœ“ è‡ªåŠ¨æå–å­—å¹•
- âœ“ API: `/api/bilibili/video-info`, `/api/bilibili/transcript`

**æœ¬åœ°è§†é¢‘** (æ–°å¢)
- âœ“ æ”¯æŒä¸Šä¼ è§†é¢‘æ–‡ä»¶ (MP4, WebM, OGG, MOV)
- âœ“ æ”¯æŒä¸Šä¼ å­—å¹•æ–‡ä»¶ (SRT, VTT)
- âœ“ å­—å¹•è§£æå™¨ (`lib/subtitle-parser.ts`)
- âœ“ è§†é¢‘å­˜å‚¨åˆ° Supabase Storage
- âœ“ API: `/api/local/upload-video`, `/api/local/upload-subtitle`
- âœ“ UI: `LocalVideoUpload` ç»„ä»¶
- âš ï¸ éœ€è¦ç”¨æˆ·ç™»å½•

### 2. è§†é¢‘åˆé›†åŠŸèƒ½ âœ“

**åˆé›†ç®¡ç†**
- âœ“ åˆ›å»º/ç¼–è¾‘/åˆ é™¤è§†é¢‘åˆé›†
- âœ“ æ·»åŠ è§†é¢‘åˆ°åˆé›†
- âœ“ ä»åˆé›†ç§»é™¤è§†é¢‘
- âœ“ åˆé›†åˆ—è¡¨é¡µé¢ (`/collections`)
- âœ“ åˆé›†è¯¦æƒ…é¡µé¢ (`/collections/[id]`)
- âœ“ æ•°æ®åº“è¡¨: `video_collections`, `collection_videos`
- âœ“ å®Œæ•´çš„ API ç«¯ç‚¹
- âœ“ è¡Œçº§å®‰å…¨ç­–ç•¥ (RLS)

### 3. å…¶ä»–æ”¹è¿› âœ“

- âœ“ æ›´æ–°ç±»å‹ç³»ç»Ÿ (`VideoSource`, `VideoCollection` ç­‰)
- âœ“ URL è¾“å…¥æ¡†æ”¯æŒ YouTube å’Œ Bilibili
- âœ“ ä¸»é¡µæ·»åŠ æ ‡ç­¾é¡µåˆ‡æ¢ (URL / æœ¬åœ°ä¸Šä¼ )
- âœ“ æ•°æ®åº“è¿ç§»è„šæœ¬
- âœ“ å®Œæ•´çš„ä¸­æ–‡æ–‡æ¡£ (`FEATURES_CN.md`)

---

## ğŸ“Š æŠ€æœ¯ç»†èŠ‚

### æ–°å¢æ–‡ä»¶
```
lib/
  â””â”€â”€ subtitle-parser.ts           # å­—å¹•è§£æå·¥å…·

app/api/
  â”œâ”€â”€ bilibili/
  â”‚   â”œâ”€â”€ video-info/route.ts     # Bilibili è§†é¢‘ä¿¡æ¯
  â”‚   â””â”€â”€ transcript/route.ts      # Bilibili å­—å¹•æå–
  â”œâ”€â”€ local/
  â”‚   â”œâ”€â”€ upload-video/route.ts   # æœ¬åœ°è§†é¢‘ä¸Šä¼ 
  â”‚   â””â”€â”€ upload-subtitle/route.ts # å­—å¹•æ–‡ä»¶ä¸Šä¼ 
  â””â”€â”€ collections/
      â”œâ”€â”€ route.ts                 # åˆé›† CRUD
      â”œâ”€â”€ [collectionId]/route.ts # å•ä¸ªåˆé›†
      â””â”€â”€ [collectionId]/videos/route.ts # åˆé›†è§†é¢‘ç®¡ç†

app/
  â””â”€â”€ collections/
      â”œâ”€â”€ page.tsx                 # åˆé›†åˆ—è¡¨
      â””â”€â”€ [collectionId]/page.tsx  # åˆé›†è¯¦æƒ…

components/
  â””â”€â”€ local-video-upload.tsx       # æœ¬åœ°ä¸Šä¼ ç»„ä»¶

supabase/migrations/
  â”œâ”€â”€ 20240101000000_add_collections.sql  # åˆé›†è¡¨
  â””â”€â”€ 20240101000001_add_videos_storage.sql # è§†é¢‘å­˜å‚¨
```

### ä¿®æ”¹æ–‡ä»¶
```
lib/
  â”œâ”€â”€ types.ts                     # æ–°å¢ç±»å‹å®šä¹‰
  â””â”€â”€ utils.ts                     # æ–°å¢å·¥å…·å‡½æ•°

app/
  â””â”€â”€ page.tsx                     # æ·»åŠ ä¸Šä¼ é€‰é¡¹

components/
  â””â”€â”€ url-input.tsx                # æ”¯æŒå¤šå¹³å°
```

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### ä½¿ç”¨ Bilibili è§†é¢‘
1. å¤åˆ¶ Bilibili è§†é¢‘é“¾æ¥
2. åœ¨ä¸»é¡µç²˜è´´é“¾æ¥
3. ç‚¹å‡»æäº¤è¿›è¡Œåˆ†æ

### ä¸Šä¼ æœ¬åœ°è§†é¢‘
1. ç¡®ä¿å·²ç™»å½•
2. åˆ‡æ¢åˆ° "Local Upload" æ ‡ç­¾
3. é€‰æ‹©è§†é¢‘å’Œå­—å¹•æ–‡ä»¶
4. å¡«å†™æ ‡é¢˜
5. ç‚¹å‡»ä¸Šä¼ 

### ç®¡ç†è§†é¢‘åˆé›†
1. è®¿é—® `/collections` é¡µé¢
2. åˆ›å»ºæ–°åˆé›†
3. åœ¨è§†é¢‘åˆ†æé¡µæ·»åŠ è§†é¢‘åˆ°åˆé›†
4. åœ¨åˆé›†è¯¦æƒ…é¡µç®¡ç†è§†é¢‘

---

## âš™ï¸ éƒ¨ç½²è¯´æ˜

### 1. æ•°æ®åº“è¿ç§»
åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œï¼š
```sql
-- æ‰§è¡Œè¿™ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹
supabase/migrations/20240101000000_add_collections.sql
supabase/migrations/20240101000001_add_videos_storage.sql
```

### 2. Supabase Storage
ç¡®ä¿ `videos` bucket å·²åˆ›å»ºå¹¶è®¾ç½®ä¸º public

### 3. ç¯å¢ƒå˜é‡
æ— éœ€æ–°å¢ç¯å¢ƒå˜é‡ï¼Œä½¿ç”¨ç°æœ‰é…ç½®å³å¯

---

## ğŸ“ å¾…åŠäº‹é¡¹

å½“å‰å®ç°å·²ç»å®Œæ•´ï¼Œåç»­å¯ä»¥è€ƒè™‘ï¼š

- [ ] æ‰¹é‡ä¸Šä¼ è§†é¢‘åˆ°åˆé›†
- [ ] åˆé›†åˆ†äº«åŠŸèƒ½
- [ ] è‡ªåŠ¨å­—å¹•ç”Ÿæˆï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰
- [ ] æ”¯æŒæ›´å¤šè§†é¢‘å¹³å°
- [ ] è§†é¢‘é¢„è§ˆå’Œå‰ªè¾‘åŠŸèƒ½

---

## ğŸ› å·²çŸ¥é—®é¢˜

- æ„å»ºæ—¶æœ‰ä¸€äº› ESLint è­¦å‘Šï¼ˆæœªä½¿ç”¨çš„å˜é‡ï¼‰ï¼Œä½†ä¸å½±å“åŠŸèƒ½
- Bilibili API å¯èƒ½å—åˆ°é€Ÿç‡é™åˆ¶
- æœ¬åœ°è§†é¢‘ä¸Šä¼ é™åˆ¶ä¸º 500MB

---

## ğŸ“ é—®é¢˜åé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ– Pull Requestã€‚
